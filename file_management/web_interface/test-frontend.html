<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯åŠŸèƒ½æµ‹è¯•</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.0/dist/echarts.min.js"></script>
</head>
<body>
    <div id="test-results"></div>
    <script>
        console.log("ğŸ§ª å¼€å§‹å‰ç«¯åŠŸèƒ½æµ‹è¯•...");
        
        // æµ‹è¯•APIè¿æ¥
        async function testAPIConnection() {
            console.log("ğŸ“¡ æµ‹è¯•APIè¿æ¥...");
            try {
                const response = await fetch('http://localhost:8003/api/v1/health');
                const data = await response.json();
                console.log("âœ… APIå¥åº·æ£€æŸ¥é€šè¿‡:", data);
                return true;
            } catch (error) {
                console.error("âŒ APIè¿æ¥å¤±è´¥:", error);
                return false;
            }
        }
        
        // æµ‹è¯•æ•°æ®è·å–
        async function testDataFetch() {
            console.log("ğŸ“Š æµ‹è¯•æ•°æ®è·å–...");
            try {
                const response = await fetch('http://localhost:8003/api/v1/data/overview');
                const data = await response.json();
                console.log("âœ… æ•°æ®æ¦‚è§ˆè·å–æˆåŠŸ:", {
                    success: data.success,
                    symbols: data.data?.statistics?.total_symbols,
                    datapoints: data.data?.statistics?.total_datapoints,
                    factors: data.data?.statistics?.active_factors
                });
                return data;
            } catch (error) {
                console.error("âŒ æ•°æ®è·å–å¤±è´¥:", error);
                return null;
            }
        }
        
        // æµ‹è¯•AIå› å­ç”Ÿæˆ
        async function testAIGeneration() {
            console.log("ğŸ¤– æµ‹è¯•AIå› å­ç”Ÿæˆ...");
            try {
                const response = await fetch('http://localhost:8003/api/v1/factors/generate');
                const data = await response.json();
                console.log("âœ… AIå› å­ç”ŸæˆæˆåŠŸ:", {
                    success: data.success,
                    factorName: data.data?.factor?.name,
                    aiScore: data.data?.factor?.ai_score,
                    cost: data.data?.generation_cost
                });
                return data;
            } catch (error) {
                console.error("âŒ AIå› å­ç”Ÿæˆå¤±è´¥:", error);
                return null;
            }
        }
        
        // æµ‹è¯•å› å­åº“
        async function testFactorLibrary() {
            console.log("ğŸ“š æµ‹è¯•å› å­åº“...");
            try {
                const response = await fetch('http://localhost:8003/api/v1/factors/library');
                const data = await response.json();
                console.log("âœ… å› å­åº“è·å–æˆåŠŸ:", {
                    success: data.success,
                    factorCount: data.data?.total_count,
                    categories: Object.keys(data.data?.categories || {}).length
                });
                return data;
            } catch (error) {
                console.error("âŒ å› å­åº“è·å–å¤±è´¥:", error);
                return null;
            }
        }
        
        // æµ‹è¯•Chart.js
        function testChartJS() {
            console.log("ğŸ“ˆ æµ‹è¯•Chart.js...");
            try {
                if (typeof Chart !== 'undefined') {
                    console.log("âœ… Chart.jsåŠ è½½æˆåŠŸ, ç‰ˆæœ¬:", Chart.version);
                    return true;
                } else {
                    console.error("âŒ Chart.jsæœªåŠ è½½");
                    return false;
                }
            } catch (error) {
                console.error("âŒ Chart.jsæµ‹è¯•å¤±è´¥:", error);
                return false;
            }
        }
        
        // æµ‹è¯•ECharts
        function testECharts() {
            console.log("ğŸ“Š æµ‹è¯•ECharts...");
            try {
                if (typeof echarts !== 'undefined') {
                    console.log("âœ… EChartsåŠ è½½æˆåŠŸ, ç‰ˆæœ¬:", echarts.version);
                    return true;
                } else {
                    console.error("âŒ EChartsæœªåŠ è½½");
                    return false;
                }
            } catch (error) {
                console.error("âŒ EChartsæµ‹è¯•å¤±è´¥:", error);
                return false;
            }
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            console.log("ğŸš€ å¼€å§‹æ‰§è¡Œå®Œæ•´åŠŸèƒ½æµ‹è¯•...");
            
            const results = {
                timestamp: new Date().toISOString(),
                tests: {}
            };
            
            // æµ‹è¯•å›¾è¡¨åº“
            results.tests.chartJS = testChartJS();
            results.tests.echarts = testECharts();
            
            // æµ‹è¯•APIè¿æ¥
            results.tests.apiConnection = await testAPIConnection();
            
            // æµ‹è¯•æ•°æ®è·å–
            results.tests.dataFetch = await testDataFetch();
            
            // æµ‹è¯•AIç”Ÿæˆ
            results.tests.aiGeneration = await testAIGeneration();
            
            // æµ‹è¯•å› å­åº“
            results.tests.factorLibrary = await testFactorLibrary();
            
            // æ€»ç»“ç»“æœ
            const passedTests = Object.values(results.tests).filter(Boolean).length;
            const totalTests = Object.keys(results.tests).length;
            
            console.log("ğŸ“‹ æµ‹è¯•æ€»ç»“:", {
                é€šè¿‡: passedTests,
                æ€»è®¡: totalTests,
                æˆåŠŸç‡: `${(passedTests/totalTests*100).toFixed(1)}%`,
                è¯¦ç»†ç»“æœ: results.tests
            });
            
            // æ˜¾ç¤ºç»“æœåˆ°é¡µé¢
            document.getElementById('test-results').innerHTML = `
                <h2>å‰ç«¯åŠŸèƒ½æµ‹è¯•ç»“æœ</h2>
                <p>æµ‹è¯•æ—¶é—´: ${results.timestamp}</p>
                <p>é€šè¿‡: ${passedTests}/${totalTests} (${(passedTests/totalTests*100).toFixed(1)}%)</p>
                <pre>${JSON.stringify(results, null, 2)}</pre>
            `;
            
            return results;
        }
        
        // é¡µé¢åŠ è½½åè¿è¡Œæµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 1000);
        });
        
        console.log("ğŸ æµ‹è¯•è„šæœ¬å·²åŠ è½½ï¼Œç­‰å¾…é¡µé¢å®ŒæˆåŠ è½½...");
    </script>
</body>
</html>